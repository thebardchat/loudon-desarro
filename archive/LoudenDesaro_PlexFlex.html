<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Louden/Desaro Gymnasium — PLEX FLEX Arena</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;800&family=Barlow+Condensed:wght@300;400;500;600&family=Barlow:wght@300;400&display=swap');
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:#060608;color:#fff;font-family:'Barlow',sans-serif;overflow:hidden;width:100vw;height:100vh}
  canvas{display:block}
  #C{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1}

  #hero{
    position:fixed;top:0;left:0;width:100%;height:100%;z-index:20;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    background:radial-gradient(ellipse at 50% 40%,rgba(15,12,8,0.1) 0%,rgba(6,6,8,0.92) 70%);
    transition:opacity 1.2s ease;
  }
  #hero.off{opacity:0;pointer-events:none}
  .hl{font-family:'Barlow Condensed',sans-serif;font-weight:300;font-size:13px;letter-spacing:7px;text-transform:uppercase;color:rgba(212,175,55,0.7);margin-bottom:18px;opacity:0;animation:r 1s .3s forwards}
  .hn{font-family:'Playfair Display',serif;font-weight:800;font-size:clamp(32px,7vw,90px);line-height:.92;text-align:center;letter-spacing:-2px;opacity:0;animation:r 1s .5s forwards}
  .hn em{font-style:italic;font-weight:400;color:#d4af37;display:block;font-size:.3em;letter-spacing:6px;margin-top:10px;font-family:'Barlow Condensed',sans-serif;text-transform:uppercase}
  .hn .sub{display:block;font-size:.22em;letter-spacing:8px;font-family:'Barlow Condensed',sans-serif;font-weight:300;color:rgba(255,255,255,0.35);margin-top:8px;text-transform:uppercase}
  .hd{font-weight:300;font-size:clamp(13px,1.8vw,16px);color:rgba(255,255,255,0.38);margin-top:22px;text-align:center;max-width:560px;line-height:1.7;opacity:0;animation:r 1s .8s forwards}
  .hg{display:grid;grid-template-columns:repeat(5,1fr);gap:28px;margin-top:36px;opacity:0;animation:r 1s 1s forwards}
  .hv{font-family:'Playfair Display',serif;font-weight:700;font-size:26px;color:#d4af37;text-align:center}
  .hlb{font-family:'Barlow Condensed',sans-serif;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.25);text-align:center;margin-top:3px}
  .hb{margin-top:40px;padding:14px 52px;background:0;border:1px solid rgba(212,175,55,0.4);color:#d4af37;font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:500;letter-spacing:5px;text-transform:uppercase;cursor:pointer;transition:all .3s;opacity:0;animation:r 1s 1.3s forwards}
  .hb:hover{background:#d4af37;color:#0a0a0a}

  #hud{position:fixed;z-index:5;top:0;left:0;width:100%;height:100%;pointer-events:none;opacity:0;transition:opacity .6s}
  #hud.on{opacity:1}
  .bar{position:absolute;top:0;left:0;right:0;height:60px;background:linear-gradient(180deg,rgba(6,6,8,.75) 0%,transparent);display:flex;justify-content:space-between;align-items:center;padding:0 24px}
  .brand{font-family:'Playfair Display',serif;font-weight:700;font-size:14px}
  .brand span{color:#d4af37}
  .tinf{font-family:'Barlow Condensed',sans-serif;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.22)}

  .tog{position:absolute;top:66px;left:50%;transform:translateX(-50%);pointer-events:auto;display:flex;gap:2px}
  .tb{padding:6px 14px;background:rgba(6,6,8,.72);border:1px solid rgba(212,175,55,.15);color:rgba(255,255,255,.32);font-family:'Barlow Condensed',sans-serif;font-size:9px;letter-spacing:2px;text-transform:uppercase;cursor:pointer;transition:all .2s}
  .tb:first-child{border-radius:3px 0 0 3px}.tb:last-child{border-radius:0 3px 3px 0}
  .tb.on{background:rgba(212,175,55,.12);border-color:#d4af37;color:#d4af37}

  #vl{position:absolute;bottom:72px;left:50%;transform:translateX(-50%);text-align:center}
  .vn{font-family:'Playfair Display',serif;font-weight:700;font-size:20px;text-shadow:0 2px 14px rgba(0,0,0,.9)}
  .vd{font-family:'Barlow Condensed',sans-serif;font-size:11px;letter-spacing:2px;color:#d4af37;margin-top:4px;text-transform:uppercase}

  .nav{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:4px;pointer-events:auto;flex-wrap:wrap;justify-content:center;max-width:96vw}
  .nb{padding:7px 12px;background:rgba(6,6,8,.6);border:1px solid rgba(212,175,55,.1);color:rgba(255,255,255,.4);font-family:'Barlow Condensed',sans-serif;font-size:9px;letter-spacing:2px;text-transform:uppercase;cursor:pointer;transition:all .2s}
  .nb:hover,.nb.on{background:rgba(212,175,55,.1);border-color:rgba(212,175,55,.35);color:#d4af37}

  @keyframes r{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  @media(max-width:600px){.hg{grid-template-columns:repeat(3,1fr);gap:14px}.nav{gap:3px}}
</style>
</head>
<body>
<div id="C"></div>

<div id="hero">
  <div class="hl">Hazel Green · Alabama</div>
  <h1 class="hn">Louden / Desaro
    <em>Gymnasium</em>
    <span class="sub">featuring PLEX FLEX™ Retractable Arena System</span>
  </h1>
  <p class="hd">A 50,000 square foot quonset-style training complex with the world's first retractable concrete beam bleacher system — transforming from indoor arena to outdoor stadium seating in minutes.</p>
  <div class="hg">
    <div><div class="hv">50K</div><div class="hlb">Square Feet</div></div>
    <div><div class="hv">2,600</div><div class="hlb">Seat Capacity</div></div>
    <div><div class="hv">NCAA</div><div class="hlb">Wrestling Arena</div></div>
    <div><div class="hv">40 yd</div><div class="hlb">Indoor Turf</div></div>
    <div><div class="hv">FLEX</div><div class="hlb">Plex Flex™</div></div>
  </div>
  <button class="hb" onclick="go()">Enter The Facility →</button>
</div>

<div id="hud">
  <div class="bar">
    <div class="brand">Louden / <span>Desaro</span> <span style="font-family:'Barlow Condensed';font-weight:300;font-size:10px;letter-spacing:3px;color:rgba(212,175,55,0.5);margin-left:8px">PLEX FLEX™</span></div>
    <div class="tinf">Hazel Green, AL · 50,000 SF · 200' × 250'</div>
  </div>

  <div class="tog">
    <button class="tb on" onclick="flex('full_in')">Full Arena</button>
    <button class="tb" onclick="flex('half')">Half & Half</button>
    <button class="tb" onclick="flex('full_out')">Full Outdoor</button>
    <button class="tb" onclick="flex('training')">Training</button>
  </div>

  <div id="vl"><div class="vn" id="VN">Exterior</div><div class="vd" id="VD">Quonset Hangar · 200' × 250' · 65' Peak</div></div>

  <div class="nav">
    <button class="nb on" onclick="vw(0)">Exterior</button>
    <button class="nb" onclick="vw(1)">Wrestling Arena</button>
    <button class="nb" onclick="vw(2)">PLEX FLEX</button>
    <button class="nb" onclick="vw(3)">Turf</button>
    <button class="nb" onclick="vw(4)">S&C</button>
    <button class="nb" onclick="vw(5)">Outdoor Bleachers</button>
    <button class="nb" onclick="vw(6)">Aerial</button>
    <button class="nb" onclick="vw(7)">Auto Tour</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
// ============================================================
// LOUDEN/DESARO — 50,000 SF PLEX FLEX ARENA
// 200' wide × 250' long × 65' peak (quonset hangar)
// ============================================================

const F=.3048;
const BW=200*F, BL=250*F, BH=65*F;

// Renderer — LEAN
const R=new THREE.WebGLRenderer({antialias:false,powerPreference:'high-performance'});
R.setSize(innerWidth,innerHeight);
R.setPixelRatio(1);
R.toneMapping=THREE.ACESFilmicToneMapping;
R.toneMappingExposure=1.05;
document.getElementById('C').appendChild(R.domElement);

const sc=new THREE.Scene();
sc.background=new THREE.Color(0x0a0e14);

const cam=new THREE.PerspectiveCamera(50,innerWidth/innerHeight,0.5,500);
cam.position.set(90,30,-50);

// Lights — no shadows
sc.add(new THREE.AmbientLight(0x506080,0.45));
sc.add(new THREE.HemisphereLight(0x8ecae6,0x2a1f0a,0.55));
const sun=new THREE.DirectionalLight(0xfff0d0,1.6);
sun.position.set(60,80,40);sc.add(sun);

// Interior
[{x:BW/2,y:8,z:BL*.3},{x:BW/2,y:8,z:BL*.6},{x:BW*.25,y:6,z:BL*.2},{x:BW*.75,y:6,z:BL*.7}].forEach(l=>{
  const p=new THREE.PointLight(0xffeedd,1.2,50);p.position.set(l.x,l.y,l.z);sc.add(p);
});

// Materials — Lambert for perf
const m=(c,o)=>new THREE.MeshLambertMaterial({color:c,...(o||{})});
const M={
  slab:m(0x7a7a78),metal:m(0x2a3848),metalIn:m(0x384858),
  wall:m(0xe5e0d8),mat:m(0xa01020),gold:m(0xd4af37),
  turf:m(0x2d7a30),white:m(0xeeeeee),rubber:m(0x1a1a1e),
  glass:m(0x88ccee,{transparent:true,opacity:0.18}),
  glassFr:m(0x445566,{transparent:true,opacity:0.1}),
  steel:m(0x484848),office:m(0xb8a07a),
  concrete:m(0x8a8a85),concreteTop:m(0x9a9a95),
  beam:m(0x7a7a78),track:m(0x555555),
  door:m(0xd4af37),asphalt:m(0x2a2a2a),ground:m(0x1e2a16),
  sign:m(0x0a0a0e),equip:m(0x222228),field:m(0x1a5a20),
};

function bx(w,h,d,x,y,z,mt){
  const o=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),mt);
  o.position.set(x,y,z);sc.add(o);return o;
}

// ============ GROUND ============
const gnd=new THREE.Mesh(new THREE.PlaneGeometry(500,500),M.ground);
gnd.rotation.x=-Math.PI/2;gnd.position.y=-0.25;sc.add(gnd);

// Parking south
bx(80,0.08,30, BW/2,-0.15,-18, M.asphalt);
for(let i=0;i<24;i++)bx(0.08,0.01,5, 6+i*3,-0.08,-18, M.white);

// Outdoor field (east side where beams extend)
bx(60,0.05,BL, BW+30,-0.15,BL/2, M.field);

// ============ SLAB ============
bx(BW+0.3,0.18,BL+0.3, BW/2,-0.09,BL/2, M.slab);

// ============ QUONSET HANGAR SHELL ============
(function(){
  const a=BW/2, b=BH, seg=20, t=0.5;
  // Shell cross-section
  const shape=new THREE.Shape();
  shape.moveTo(-a,0);
  for(let i=0;i<=seg;i++){
    const ang=Math.PI*i/seg;
    shape.lineTo(-a*Math.cos(ang), b*Math.sin(ang));
  }
  shape.lineTo(a,0);
  const hole=new THREE.Path();
  const ai=a-t, bi=b-t;
  hole.moveTo(-ai,0);
  for(let i=0;i<=seg;i++){
    const ang=Math.PI*i/seg;
    hole.lineTo(-ai*Math.cos(ang), bi*Math.sin(ang));
  }
  hole.lineTo(ai,0);
  shape.holes.push(hole);
  const geo=new THREE.ExtrudeGeometry(shape,{steps:1,depth:BL,bevelEnabled:false});
  const mesh=new THREE.Mesh(geo,M.metal);
  mesh.position.set(BW/2,0,0);sc.add(mesh);

  // South cap (glass entrance facade)
  const cs=new THREE.Shape();
  cs.moveTo(-a,0);
  for(let i=0;i<=seg;i++){const ang=Math.PI*i/seg;cs.lineTo(-a*Math.cos(ang),b*Math.sin(ang));}
  cs.lineTo(a,0);
  const cg=new THREE.ShapeGeometry(cs);
  const cm=new THREE.Mesh(cg,M.glassFr);cm.position.set(BW/2,0,0.02);sc.add(cm);

  // North cap (solid)
  const nm=new THREE.Mesh(cg.clone(),m(0x1a2530));nm.position.set(BW/2,0,BL-0.02);sc.add(nm);
})();

// ============ STEEL RIBS ============
for(let f=0;f<=10;f++){
  const z=f*25*F, seg=16;
  const pts=[];
  for(let i=0;i<=seg;i++){
    const ang=Math.PI*i/seg;
    pts.push(new THREE.Vector3(-BW/2*Math.cos(ang)+BW/2, BH*Math.sin(ang), z));
  }
  const curve=new THREE.CatmullRomCurve3(pts);
  const geo=new THREE.TubeGeometry(curve,seg,0.12,4,false);
  sc.add(new THREE.Mesh(geo,M.steel));
}

// ============ CURVED GLASS GARAGE DOORS (East wall — follow the curve) ============
(function(){
  const numDoors=10, dh=16*F;
  const doorSpacing=BL/numDoors;
  for(let i=0;i<numDoors;i++){
    const z=i*doorSpacing+doorSpacing/2;
    // Glass panel — positioned on the east curve of the hangar
    // At the base, the hangar wall is at x=BW
    const g=new THREE.Mesh(new THREE.PlaneGeometry(doorSpacing-0.3,dh),M.glass);
    g.position.set(BW-0.15,dh/2+1,z);g.rotation.y=Math.PI/2;sc.add(g);
    // Gold frame
    bx(doorSpacing-0.3,0.06,0.06, BW-0.1,dh+1,z, M.door);
    bx(0.06,dh,0.06, BW-0.1,dh/2+1,i*doorSpacing, M.door);
  }
})();

// ============ ENTRANCE (South — gold doors) ============
bx(4,4,0.15, BW*.4,2,-0.08, M.door);
bx(4,4,0.15, BW*.55,2,-0.08, M.door);
// Sign
bx(16,3,0.08, BW/2,BH*.45,-0.2, M.sign);
bx(17,0.06,0.1, BW/2,BH*.45-1.6,-0.22, M.door);

// ============ INTERIOR ZONES ============

// --- WRESTLING AREA (south/curved end — first 80') ---
const WZ=80*F; // wrestling zone depth
const MS=42*F; // NCAA mat

// 3 training mats
const trainG=new THREE.Group();trainG.name="trainMats";
function makeMat(x,z,parent){
  const b=new THREE.Mesh(new THREE.BoxGeometry(MS,0.06,MS),M.mat);
  b.position.set(x+MS/2,0.03,z+MS/2);parent.add(b);
  const c=new THREE.Mesh(new THREE.CylinderGeometry(3,3,0.01,12),M.gold);
  c.position.set(x+MS/2,0.07,z+MS/2);parent.add(c);
  const r2=new THREE.Mesh(new THREE.TorusGeometry(5.8,0.07,6,20),M.gold);
  r2.rotation.x=-Math.PI/2;r2.position.set(x+MS/2,0.07,z+MS/2);parent.add(r2);
}
makeMat(BW/2-MS-3*F, 5*F, trainG);
makeMat(BW/2+3*F, 5*F, trainG);
makeMat(BW/2-MS/2, 5*F+MS+5*F, trainG);
sc.add(trainG);

// Single arena mat (for full arena mode)
const arenaMatG=new THREE.Group();arenaMatG.name="arenaMat";arenaMatG.visible=false;
makeMat(BW/2-MS/2, WZ/2-MS/2, arenaMatG);
sc.add(arenaMatG);

// --- TURF ZONE (middle — 40 yards = 120') ---
const TZ_START=WZ+5*F;
const TZ_LEN=120*F;
const TZ_W=BW-30*F; // wide turf, leave space on sides
bx(TZ_W,0.03,TZ_LEN, BW/2,0.015,TZ_START+TZ_LEN/2, M.turf);
// Yard lines
for(let y=0;y<=8;y++){
  bx(TZ_W-2,0.005,0.06, BW/2,0.035,TZ_START+y*15*F, M.white);
}
// Hash marks
for(let y=0;y<=8;y++){
  for(let side of [-1,1]){
    bx(0.06,0.005,2, BW/2+side*(TZ_W/2-5), 0.035, TZ_START+y*15*F, M.white);
  }
}

// --- S&C ZONE (north end — remaining space) ---
const SC_START=TZ_START+TZ_LEN+5*F;
const SC_LEN=BL-SC_START-3*F;
bx(BW-10*F,0.03,SC_LEN, BW/2,0.015,SC_START+SC_LEN/2, M.rubber);

// Equipment
for(let i=0;i<8;i++){
  bx(1.2,2.2,1.2, 8+i*7,1.1,SC_START+4, M.steel); // racks
  bx(2,0.12,1.5, 8+i*7,0.06,SC_START+8, M.rubber); // platforms
}
// Dumbbell rack
bx(0.6,1.2,20, BW-5,0.6,SC_START+SC_LEN/2, M.steel);
// Ellipticals along east wall
for(let i=0;i<8;i++){
  bx(0.6,0.4,1.3, BW-8,0.2,SC_START+3+i*4.5, M.equip);
  bx(0.04,1,0.04, BW-8,0.9,SC_START+3+i*4.5-0.3, M.steel);
  bx(0.04,1,0.04, BW-8,0.9,SC_START+3+i*4.5+0.3, M.steel);
}

// ============ PLEX FLEX™ RETRACTABLE CONCRETE BEAMS ============
// 16 rows × 250' long on the east wall
// Each beam: 20' long (10' in / 10' out), ~2.5' wide, ~2.5' tall
// Beams pass through the east curved wall

const BEAM_L=20*F;  // 20 feet total length
const BEAM_W=2.5*F; // width
const BEAM_H=2.5*F; // height per step
const ROWS=16;
const BEAM_SECTIONS=12; // 12 sections across the 250' length
const BEAM_SEC_L=BL/BEAM_SECTIONS;
const WALL_X=BW; // East wall position

// Three flex groups
const flexIn=new THREE.Group();flexIn.name="flex_full_in";
const flexHalf=new THREE.Group();flexHalf.name="flex_half";flexHalf.visible=false;
const flexOut=new THREE.Group();flexOut.name="flex_full_out";flexOut.visible=false;

for(let row=0;row<ROWS;row++){
  const stepH=row*BEAM_H;
  const rowY=stepH+BEAM_H/2;

  for(let sec=0;sec<BEAM_SECTIONS;sec++){
    const secZ=sec*BEAM_SEC_L+BEAM_SEC_L/2;

    // FULL INSIDE: beam fully inside (20' from wall inward)
    const bi=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L,BEAM_H,BEAM_SEC_L-0.1),M.concrete);
    bi.position.set(WALL_X-BEAM_L/2-row*0.15, rowY, secZ);
    flexIn.add(bi);
    // Top surface (slightly lighter for seat look)
    const bt=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L,0.06,BEAM_SEC_L-0.1),M.concreteTop);
    bt.position.set(WALL_X-BEAM_L/2-row*0.15, rowY+BEAM_H/2, secZ);
    flexIn.add(bt);

    // HALF & HALF: 10' inside, 10' outside
    const hIn=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L/2,BEAM_H,BEAM_SEC_L-0.1),M.concrete);
    hIn.position.set(WALL_X-BEAM_L/4-row*0.08, rowY, secZ);
    flexHalf.add(hIn);
    const hOut=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L/2,BEAM_H,BEAM_SEC_L-0.1),M.concrete);
    hOut.position.set(WALL_X+BEAM_L/4+row*0.08, rowY, secZ);
    flexHalf.add(hOut);
    // Seats
    const htI=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L/2,0.06,BEAM_SEC_L-0.1),M.concreteTop);
    htI.position.set(WALL_X-BEAM_L/4-row*0.08, rowY+BEAM_H/2, secZ);
    flexHalf.add(htI);
    const htO=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L/2,0.06,BEAM_SEC_L-0.1),M.concreteTop);
    htO.position.set(WALL_X+BEAM_L/4+row*0.08, rowY+BEAM_H/2, secZ);
    flexHalf.add(htO);

    // FULL OUTSIDE: beam fully outside
    const bo=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L,BEAM_H,BEAM_SEC_L-0.1),M.concrete);
    bo.position.set(WALL_X+BEAM_L/2+row*0.15, rowY, secZ);
    flexOut.add(bo);
    const boT=new THREE.Mesh(new THREE.BoxGeometry(BEAM_L,0.06,BEAM_SEC_L-0.1),M.concreteTop);
    boT.position.set(WALL_X+BEAM_L/2+row*0.15, rowY+BEAM_H/2, secZ);
    flexOut.add(boT);
  }

  // Steel track rail for this row (runs through wall)
  const track=new THREE.Mesh(
    new THREE.BoxGeometry(BEAM_L*2.2,0.08,0.08),
    M.track
  );
  track.position.set(WALL_X, rowY-BEAM_H/2+0.04, BL/2);
  sc.add(track); // Tracks always visible
}

// Support columns for tracks (every ~40')
for(let col=0;col<7;col++){
  const colZ=col*BL/6;
  // Outside support columns
  const pillar=new THREE.Mesh(
    new THREE.BoxGeometry(0.4,ROWS*BEAM_H+2,0.4),
    M.steel
  );
  pillar.position.set(WALL_X+BEAM_L+2, (ROWS*BEAM_H)/2, colZ);
  sc.add(pillar);
  // Inside support columns
  const pillarIn=pillar.clone();
  pillarIn.position.set(WALL_X-BEAM_L-2, (ROWS*BEAM_H)/2, colZ);
  sc.add(pillarIn);
}

sc.add(flexIn);
sc.add(flexHalf);
sc.add(flexOut);

// ============ OFFICE (SW corner) ============
const ow=24*F, od=20*F;
bx(ow,0.04,od, ow/2,0.02,od/2, M.office);
bx(ow,12*F,0.1, ow/2,6*F,od, M.wall);
bx(0.1,12*F,od, ow,6*F,od/2, M.wall);
// Glass viewing wall
const vg=new THREE.Mesh(new THREE.PlaneGeometry(ow-1,8*F),M.glass);
vg.position.set(ow/2,5*F,od+0.05);sc.add(vg);
bx(ow,0.05,0.05, ow/2,9*F,od, M.door);
bx(ow,0.05,0.05, ow/2,3*F,od, M.door);

// ============ CAMERA VIEWS ============
const V=[
  {p:[90,28,-45],t:[BW/2,4,BL*.3],n:"Exterior",d:"Quonset Hangar · 200' × 250' · 65' Peak"},
  {p:[BW/2,5,WZ*.3],t:[BW/2,1,WZ*.5],n:"Wrestling Arena",d:"Three NCAA 42'×42' Mats · Championship Ready"},
  {p:[BW-3,8,BL*.4],t:[BW+5,5,BL*.4],n:"PLEX FLEX™ System",d:"16 Rows · 2,600 Seats · Retractable Concrete Beams"},
  {p:[BW*.4,3.5,TZ_START+TZ_LEN*.4],t:[BW*.5,0.5,TZ_START+TZ_LEN*.5],n:"40-Yard Indoor Turf",d:"Sprint · Agility · Multi-Sport Training"},
  {p:[12,4,SC_START+4],t:[BW*.4,2,SC_START+SC_LEN*.4],n:"Strength & Conditioning",d:"Power Racks · Platforms · Glass Garage Doors"},
  {p:[BW+25,12,BL*.5],t:[BW,6,BL*.5],n:"Outdoor Bleachers",d:"PLEX FLEX™ Deployed · 2,600 Outdoor Seats"},
  {p:[BW/2,90,BL*.4],t:[BW/2,0,BL*.4],n:"Aerial Overview",d:"50,000 SF · Louden/Desaro Gymnasium"},
];

let cv=0,at=null;
let tp=new THREE.Vector3(90,28,-45),tl=new THREE.Vector3(BW/2,4,BL*.3),cl=tl.clone();
let curFlex='full_in';

function vw(i){
  if(i===7){tour();return}
  if(at)clearTimeout(at);at=null;
  cv=i;const v=V[i];
  tp.set(v.p[0],v.p[1],v.p[2]);
  tl.set(v.t[0],v.t[1],v.t[2]);
  document.getElementById('VN').textContent=v.n;
  document.getElementById('VD').textContent=v.d;
  document.querySelectorAll('.nb').forEach((b,j)=>b.classList.toggle('on',j===i));

  // Auto-switch flex mode for certain views
  if(i===5)flex('full_out'); // outdoor view
  else if(i===2)flex('half'); // show the system split
}

function tour(){
  let i=0;
  document.querySelectorAll('.nb').forEach((b,j)=>b.classList.toggle('on',j===7));
  (function nx(){vw(i%7);i++;at=setTimeout(()=>{
    document.querySelectorAll('.nb').forEach((b,j)=>b.classList.toggle('on',j===7));nx();
  },5000)})();
}

function flex(mode){
  curFlex=mode;
  flexIn.visible=(mode==='full_in');
  flexHalf.visible=(mode==='half');
  flexOut.visible=(mode==='full_out');

  // Mat visibility
  if(mode==='full_in'){
    trainG.visible=false;arenaMatG.visible=true;
  } else {
    trainG.visible=true;arenaMatG.visible=false;
  }
  if(mode==='training'){
    flexIn.visible=false;flexHalf.visible=false;flexOut.visible=false;
    trainG.visible=true;arenaMatG.visible=false;
  }

  document.querySelectorAll('.tb').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.tb').forEach(b=>{
    if(b.textContent.toLowerCase().includes(
      mode==='full_in'?'full arena':mode==='half'?'half':mode==='full_out'?'full outdoor':'training'
    ))b.classList.add('on');
  });
}

function go(){
  document.getElementById('hero').classList.add('off');
  document.getElementById('hud').classList.add('on');
  vw(0);
}

// Mouse/touch orbit
let md=false,lm={x:0,y:0},ob={t:0,p:0};
R.domElement.addEventListener('mousedown',e=>{md=true;lm={x:e.clientX,y:e.clientY};if(at)clearTimeout(at);at=null});
R.domElement.addEventListener('mousemove',e=>{if(!md)return;ob.t+=(e.clientX-lm.x)*.003;ob.p=Math.max(-.5,Math.min(.5,ob.p+(e.clientY-lm.y)*.003));lm={x:e.clientX,y:e.clientY}});
R.domElement.addEventListener('mouseup',()=>md=false);
R.domElement.addEventListener('touchstart',e=>{md=true;lm={x:e.touches[0].clientX,y:e.touches[0].clientY}},{passive:true});
R.domElement.addEventListener('touchmove',e=>{if(!md)return;ob.t+=(e.touches[0].clientX-lm.x)*.005;ob.p=Math.max(-.5,Math.min(.5,ob.p+(e.touches[0].clientY-lm.y)*.005));lm={x:e.touches[0].clientX,y:e.touches[0].clientY}},{passive:true});
R.domElement.addEventListener('touchend',()=>md=false);
R.domElement.addEventListener('wheel',e=>{const d=cam.position.clone().sub(cl).normalize();tp.add(d.multiplyScalar(e.deltaY*.02))});

// RENDER — 30fps cap
let last=0;
function anim(t){
  requestAnimationFrame(anim);
  if(t-last<32)return;last=t;
  const sp=0.055;
  let fp=tp.clone();
  if(ob.t||ob.p){
    const off=cam.position.clone().sub(cl);
    const r=off.length();
    const th=Math.atan2(off.x,off.z)+ob.t;
    const ph=Math.max(.1,Math.min(1.4,Math.acos(off.y/r)+ob.p));
    fp.set(cl.x+r*Math.sin(ph)*Math.sin(th),cl.y+r*Math.cos(ph),cl.z+r*Math.sin(ph)*Math.cos(th));
  }
  cam.position.lerp(fp,sp);
  cl.lerp(tl,sp);
  cam.lookAt(cl);
  ob.t*=.92;ob.p*=.92;
  R.render(sc,cam);
}
anim(0);

addEventListener('resize',()=>{cam.aspect=innerWidth/innerHeight;cam.updateProjectionMatrix();R.setSize(innerWidth,innerHeight)});
window.vw=vw;window.go=go;window.flex=flex;
</script>
</body>
</html>
